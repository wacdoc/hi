# अपना स्वयं का SMTP मेल भेजने वाला सर्वर बनाएँ

## प्रस्तावना

SMTP क्लाउड विक्रेताओं से सीधे सेवाएं खरीद सकता है, जैसे:

* [अमेज़न एसईएस एसएमटीपी](https://docs.aws.amazon.com/ses/latest/dg/send-email-smtp.html)
* [अली क्लाउड ईमेल पुश](https://www.alibabacloud.com/help/directmail/latest/three-mail-sending-methods)

आप अपना स्वयं का मेल सर्वर भी बना सकते हैं - असीमित प्रेषण, कम समग्र लागत।

नीचे, हम चरण दर चरण प्रदर्शित करते हैं कि अपना स्वयं का मेल सर्वर कैसे बनाया जाए।

## सर्वर चयन

स्व-होस्ट किए गए SMTP सर्वर को 25, 456 और 587 खुले पोर्ट वाले सार्वजनिक IP की आवश्यकता होती है।

आमतौर पर उपयोग किए जाने वाले सार्वजनिक बादलों ने इन बंदरगाहों को डिफ़ॉल्ट रूप से अवरुद्ध कर दिया है, और वर्क ऑर्डर जारी करके उन्हें खोलना संभव हो सकता है, लेकिन यह बहुत परेशानी भरा है।

मैं एक ऐसे होस्ट से खरीदने की सलाह देता हूं जिसमें ये पोर्ट खुले हों और रिवर्स डोमेन नाम सेट करने का समर्थन करता हो।

यहाँ, मैं [कॉन्टैबो की](https://contabo.com) सलाह देता हूँ।

कॉन्टैबो म्यूनिख, जर्मनी में स्थित एक होस्टिंग प्रदाता है, जिसकी स्थापना 2003 में बहुत प्रतिस्पर्धी कीमतों के साथ की गई थी।

यदि आप यूरो को खरीद की मुद्रा के रूप में चुनते हैं, तो कीमत सस्ती होगी (8GB मेमोरी और 4 CPU के साथ एक सर्वर की लागत लगभग 529 युआन प्रति वर्ष है, और प्रारंभिक स्थापना शुल्क एक वर्ष के लिए निःशुल्क है)।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/UoAQkwY.webp)

ऑर्डर देते समय, `prefer AMD` दें, और एएमडी सीपीयू वाले सर्वर का प्रदर्शन बेहतर होगा।

निम्नलिखित में, मैं Contabo के VPS को एक उदाहरण के रूप में दिखाऊंगा कि अपना स्वयं का मेल सर्वर कैसे बनाया जाए।

## उबंटू सिस्टम कॉन्फ़िगरेशन

यहाँ ऑपरेटिंग सिस्टम Ubuntu 22.04 है

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/smpIu1F.webp)

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/m7Mwjwr.webp)

यदि ssh पर सर्वर `Welcome to TinyCore 13!` (जैसा कि नीचे चित्र में दिखाया गया है), इसका मतलब है कि सिस्टम अभी तक स्थापित नहीं हुआ है। कृपया ssh डिस्कनेक्ट करें और फिर से लॉग इन करने के लिए कुछ मिनट प्रतीक्षा करें।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/-qKACz9.webp)

जब `Welcome to Ubuntu 22.04.1 LTS` है, आरंभीकरण पूरा हो गया है, और आप निम्न चरणों के साथ जारी रख सकते हैं।

### [वैकल्पिक] विकास के माहौल को आरंभ करें

यह कदम वैकल्पिक है।

सुविधा के लिए, मैंने [github.com/wactax/ops.os/tree/main/ubuntu](https://github.com/wactax/ops.os/tree/main/ubuntu) में ubuntu सॉफ़्टवेयर की स्थापना और सिस्टम कॉन्फ़िगरेशन डाला।

एक क्लिक के साथ स्थापित करने के लिए निम्न कमांड चलाएँ।

```
bash <(curl -s https://raw.githubusercontent.com/wactax/ops.os/main/ubuntu/boot.sh)
```

चीनी उपयोगकर्ता, कृपया इसके बजाय निम्नलिखित कमांड का उपयोग करें, और भाषा, समय क्षेत्र आदि स्वचालित रूप से सेट हो जाएंगे।

```
CN=1 bash <(curl -s https://ghproxy.com/https://raw.githubusercontent.com/wactax/ops.os/main/ubuntu/boot.sh)
```

### Contabo IPV6 को सक्षम करता है

IPV6 सक्षम करें ताकि SMTP भी IPV6 पतों के साथ ईमेल भेज सके।

`/etc/sysctl.conf` संपादित करें

निम्नलिखित पंक्तियों को संशोधित या जोड़ें

```
net.ipv6.conf.all.disable_ipv6 = 0
net.ipv6.conf.default.disable_ipv6 = 0
net.ipv6.conf.lo.disable_ipv6 = 0
```

[कॉन्टैबो ट्यूटोरियल के साथ फ़ॉलो अप करें: अपने सर्वर में IPv6 कनेक्टिविटी जोड़ना](https://contabo.com/blog/adding-ipv6-connectivity-to-your-server/)

`/etc/netplan/01-netcfg.yaml` संपादित करें, कुछ पंक्तियाँ जोड़ें जैसा कि नीचे चित्र में दिखाया गया है (Contabo VPS डिफ़ॉल्ट कॉन्फ़िगरेशन फ़ाइल में पहले से ही ये पंक्तियाँ हैं, बस उन्हें अनकमेंट करें)।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/5MEi41I.webp)

फिर संशोधित कॉन्फ़िगरेशन को प्रभावी बनाने के लिए `netplan apply` ।

कॉन्फ़िगरेशन सफल होने के बाद, आप अपने बाहरी नेटवर्क के ipv6 पते को देखने के लिए `curl 6.ipw.cn` उपयोग कर सकते हैं।

## कॉन्फ़िगरेशन रिपॉजिटरी ऑप्स को क्लोन करें

```
git clone https://github.com/wactax/ops.soft.git
```

## अपने डोमेन नाम के लिए एक मुफ़्त एसएसएल प्रमाणपत्र बनाएं

मेल भेजने के लिए एन्क्रिप्शन और हस्ताक्षर करने के लिए एसएसएल प्रमाणपत्र की आवश्यकता होती है।

प्रमाणपत्र बनाने के लिए हम [acme.sh का](https://github.com/acmesh-official/acme.sh) उपयोग करते हैं।

acme.sh एक ओपन सोर्स ऑटोमेटेड सर्टिफिकेट साइनिंग टूल है,

कॉन्फ़िगरेशन वेयरहाउस ops.soft दर्ज करें, `./ssl.sh` चलाएँ, और **ऊपरी निर्देशिका** में एक `conf` फ़ोल्डर बनाया जाएगा।

[acme.sh dnsapi](https://github.com/acmesh-official/acme.sh/wiki/dnsapi) से अपना DNS प्रदाता खोजें, `conf/conf.sh` संपादित करें।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/Qjq1C1i.webp)

फिर अपने डोमेन नाम के लिए `123.com` और `*.123.com` प्रमाणपत्र बनाने के लिए `./ssl.sh 123.com` चलाएँ।

पहला रन स्वचालित रूप से [acme.sh](https://github.com/acmesh-official/acme.sh) स्थापित करेगा और स्वत: नवीनीकरण के लिए एक निर्धारित कार्य जोड़ देगा। आप `crontab -l` देख सकते हैं, इस प्रकार की एक रेखा है।

```
52 0 * * * "/mnt/www/.acme.sh"/acme.sh --cron --home "/mnt/www/.acme.sh" > /dev/null
```

जनरेट किए गए प्रमाणपत्र के लिए पथ कुछ इस तरह है `/mnt/www/.acme.sh/123.com_ecc。`

प्रमाणपत्र नवीनीकरण कॉल करेगा `conf/reload/123.com.sh` स्क्रिप्ट, इस स्क्रिप्ट को संपादित करें, आप संबंधित अनुप्रयोगों के प्रमाणपत्र कैश को रीफ्रेश करने के लिए `nginx -s reload` जैसे आदेश जोड़ सकते हैं।

## Chasquid के साथ SMTP सर्वर बनाएँ

[Chasquid](https://github.com/albertito/chasquid) गो भाषा में लिखा गया एक ओपन सोर्स एसएमटीपी सर्वर है।

प्राचीन मेल सर्वर प्रोग्राम जैसे कि पोस्टफ़िक्स और सेंडमेल के विकल्प के रूप में, चास्क्विड सरल और उपयोग में आसान है, और यह माध्यमिक विकास के लिए भी आसान है।

Run `./chasquid/init.sh 123.com` एक क्लिक के साथ स्वचालित रूप से स्थापित हो जाएगा (123.com को अपने भेजने वाले डोमेन नाम से बदलें)।

## ईमेल हस्ताक्षर डीकेआईएम कॉन्फ़िगर करें

पत्रों को स्पैम के रूप में माने जाने से रोकने के लिए ईमेल हस्ताक्षर भेजने के लिए DKIM का उपयोग किया जाता है।

कमांड के सफलतापूर्वक चलने के बाद, आपको DKIM रिकॉर्ड सेट करने के लिए कहा जाएगा (जैसा कि नीचे दिखाया गया है)।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/LJWGsmI.webp)

बस अपने DNS में एक TXT रिकॉर्ड जोड़ें (जैसा कि नीचे दिखाया गया है)।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/0szKWqV.webp)

## सेवा की स्थिति और लॉग देखें

 `systemctl status chasquid` सेवा की स्थिति देखें।

सामान्य ऑपरेशन की स्थिति नीचे दी गई आकृति में दिखाई गई है

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/CAwyY4E.webp)

 `grep chasquid /var/log/syslog` या `journalctl -xeu chasquid` त्रुटि लॉग देख सकते हैं।

## रिवर्स डोमेन नाम कॉन्फ़िगरेशन

रिवर्स डोमेन नाम आईपी पते को संबंधित डोमेन नाम से हल करने की अनुमति देना है।

रिवर्स डोमेन नाम सेट करने से ईमेल को स्पैम के रूप में पहचाने जाने से रोका जा सकता है।

जब मेल प्राप्त होता है, तो प्राप्त करने वाला सर्वर यह पुष्टि करने के लिए भेजने वाले सर्वर के आईपी पते पर रिवर्स डोमेन नाम विश्लेषण करेगा कि भेजने वाले सर्वर के पास वैध रिवर्स डोमेन नाम है या नहीं।

यदि भेजने वाले सर्वर के पास रिवर्स डोमेन नाम नहीं है या यदि रिवर्स डोमेन नाम भेजने वाले सर्वर के आईपी पते से मेल नहीं खाता है, तो प्राप्त करने वाला सर्वर ईमेल को स्पैम के रूप में पहचान सकता है या इसे अस्वीकार कर सकता है।

[https://my.contabo.com/rdns](https://my.contabo.com/rdns) पर जाएं और नीचे दिखाए अनुसार कॉन्फ़िगर करें

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/IIPdBk_.webp)

रिवर्स डोमेन नाम सेट करने के बाद, डोमेन नाम ipv4 और ipv6 के आगे के रिज़ॉल्यूशन को सर्वर पर कॉन्फ़िगर करना याद रखें।

## Chasquid.conf का होस्टनाम संपादित करें

रिवर्स डोमेन नाम के मान के लिए `conf/chasquid/chasquid.conf` संशोधित करें।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/6Fw4SQi.webp)

फिर सेवा को पुनरारंभ करने के लिए `systemctl restart chasquid` चलाएँ।

## git रिपॉजिटरी में बैकअप कॉन्फ

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/Fier9uv.webp)

उदाहरण के लिए, मैं इस प्रकार अपने स्वयं के जीथब प्रक्रिया के लिए गोपनीय फ़ोल्डर का बैकअप लेता हूं

पहले एक निजी गोदाम बनाएँ

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/ZSCT1t1.webp)

गोपनीय निर्देशिका दर्ज करें और गोदाम में जमा करें

```
git init
git add .
git commit -m "init"
git branch -M main
git remote add origin git@github.com:wac-tax-key/conf.git
git push -u origin main
```

## प्रेषक जोड़ें

दौड़ना

```
chasquid-util user-add i@wac.tax
```

प्रेषक जोड़ सकते हैं

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/khHjLof.webp)

### सत्यापित करें कि पासवर्ड सही तरीके से सेट है

```
chasquid-util authenticate i@wac.tax --password=xxxxxxx
```

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/e92JHXq.webp)

उपयोगकर्ता को जोड़ने के बाद, `chasquid/domains/wac.tax/users` अपडेट किया जाएगा, इसे वेयरहाउस में जमा करना याद रखें।

## डीएनएस एसपीएफ़ रिकॉर्ड जोड़ें

SPF (सेंडर पॉलिसी फ्रेमवर्क) एक ईमेल सत्यापन तकनीक है जिसका उपयोग ईमेल धोखाधड़ी को रोकने के लिए किया जाता है।

यह मेल भेजने वाले की पहचान की पुष्टि करता है कि प्रेषक का आईपी पता उस डोमेन नाम के डीएनएस रिकॉर्ड से मेल खाता है जिसका वह दावा करता है, धोखेबाजों को फर्जी ईमेल भेजने से रोकता है।

SPF रिकॉर्ड जोड़ने से ईमेल को जितना संभव हो सके स्पैम के रूप में पहचाने जाने से रोका जा सकता है।

यदि आपका डोमेन नाम सर्वर SPF प्रकार का समर्थन नहीं करता है, तो बस TXT प्रकार का रिकॉर्ड जोड़ें।

उदाहरण के लिए, `wac.tax` का SPF इस प्रकार है

`v=spf1 a mx include:_spf.wac.tax include:_spf.google.com ~all`

एसपीएफ़ `_spf.wac.tax` के लिए

`v=spf1 a:smtp.wac.tax ~all`

ध्यान दें कि मैंने यहां `include:_spf.google.com` , ऐसा इसलिए है क्योंकि मैं `i@wac.tax` बाद में Google मेलबॉक्स में भेजने वाले पते के रूप में कॉन्फ़िगर करूंगा।

## डीएनएस कॉन्फ़िगरेशन DMARC

DMARC (डोमेन-आधारित संदेश प्रमाणीकरण, रिपोर्टिंग और अनुरूपता) का संक्षिप्त नाम है।

इसका उपयोग एसपीएफ़ बाउंस को पकड़ने के लिए किया जाता है (शायद कॉन्फ़िगरेशन त्रुटियों के कारण, या कोई अन्य व्यक्ति आपको स्पैम भेजने का नाटक कर रहा है)।

TXT रिकॉर्ड `_dmarc` जोड़ें,

सामग्री इस प्रकार है

```
v=DMARC1; p=quarantine; fo=1; ruf=mailto:ruf@wac.tax; rua=mailto:rua@wac.tax
```

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/k44P7O3.webp)

प्रत्येक पैरामीटर का अर्थ इस प्रकार है

### पी (नीति)

बताता है कि एसपीएफ (सेंडर पॉलिसी फ्रेमवर्क) या डीकेआईएम (डोमेनकीज आइडेंटिफाइड मेल) वेरिफिकेशन में विफल ईमेल को कैसे हैंडल किया जाए। पी पैरामीटर को तीन मानों में से एक पर सेट किया जा सकता है:

* कोई नहीं: कोई कार्रवाई नहीं की जाती है, ईमेल रिपोर्टिंग तंत्र के माध्यम से केवल सत्यापन परिणाम वापस प्रेषक को भेजा जाता है।
* क्वारंटाइन: उस मेल को डालें जिसने सत्यापन को स्पैम फ़ोल्डर में पास नहीं किया है, लेकिन मेल को सीधे अस्वीकार नहीं करेगा।
* अस्वीकार करें: सत्यापन विफल करने वाले ईमेल को सीधे अस्वीकार करें।

### एफओ (विफलता विकल्प)

रिपोर्टिंग तंत्र द्वारा लौटाई गई जानकारी की मात्रा निर्दिष्ट करता है। इसे निम्न मानों में से एक पर सेट किया जा सकता है:

* 0: सभी संदेशों के सत्यापन परिणामों की रिपोर्ट करें
* 1: केवल उन संदेशों की रिपोर्ट करें जो सत्यापन विफल होते हैं
* d: केवल डोमेन नाम सत्यापन विफलताओं की रिपोर्ट करें
* एस: केवल एसपीएफ़ सत्यापन विफलताओं की रिपोर्ट करें
* l: केवल DKIM सत्यापन विफलताओं की रिपोर्ट करें

### रूआ और रूफ

* रुआ (कुल रिपोर्ट के लिए रिपोर्टिंग यूआरआई): समग्र रिपोर्ट प्राप्त करने के लिए ईमेल पता
* आरयूएफ (फोरेंसिक रिपोर्ट के लिए यूआरआई रिपोर्टिंग): विस्तृत रिपोर्ट प्राप्त करने के लिए ईमेल पता

## ईमेल को Google मेल पर अग्रेषित करने के लिए MX रिकॉर्ड जोड़ें

क्योंकि मुझे एक मुफ्त कॉर्पोरेट मेलबॉक्स नहीं मिला जो सार्वभौमिक पतों का समर्थन करता है (कैच-ऑल, इस डोमेन नाम पर भेजे गए किसी भी ईमेल को प्राप्त कर सकता है, उपसर्गों पर प्रतिबंध के बिना), मैंने अपने जीमेल मेलबॉक्स में सभी ईमेल अग्रेषित करने के लिए चैस्किड का उपयोग किया।

**यदि आपके पास अपना स्वयं का सशुल्क व्यवसाय मेलबॉक्स है, तो कृपया MX को संशोधित न करें और इस चरण को छोड़ दें।**

`conf/chasquid/domains/wac.tax/aliases` संपादित करें, अग्रेषण मेलबॉक्स सेट करें

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/OBDl2gw.webp)

`*` सभी ईमेल इंगित करता है, `i` ऊपर बनाए गए भेजने वाले उपयोगकर्ता का ईमेल पता उपसर्ग है। मेल अग्रेषित करने के लिए, प्रत्येक उपयोगकर्ता को एक पंक्ति जोड़ने की आवश्यकता होती है।

फिर एमएक्स रिकॉर्ड जोड़ें (मैं सीधे यहां रिवर्स डोमेन नाम के पते की ओर इशारा करता हूं, जैसा कि नीचे दिए गए चित्र में पहली पंक्ति में दिखाया गया है)।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/7__KrU8.webp)

कॉन्फ़िगरेशन पूर्ण होने के बाद, आप `i@wac.tax` और `any123@wac.tax` पर ईमेल भेजने के लिए अन्य ईमेल पतों का उपयोग यह देखने के लिए कर सकते हैं कि क्या आप Gmail में ईमेल प्राप्त कर सकते हैं।

यदि नहीं, तो चैस्क्विड लॉग ( `grep chasquid /var/log/syslog` ) की जाँच करें।

## Google मेल से i@wac.tax को एक ईमेल भेजें

Google मेल द्वारा मेल प्राप्त करने के बाद, मैं स्वाभाविक रूप से i.wac.tax@gmail.com के बजाय `i@wac.tax` के साथ उत्तर देने की आशा करता था।

[https://mail.google.com/mail/u/1/#settings/accounts](https://mail.google.com/mail/u/1/#settings/accounts) पर जाएं और "एक और ईमेल पता जोड़ें" पर क्लिक करें।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/PAvyE3C.webp)

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/_OgLsPT.webp)

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/XIUf6Dc.webp)

फिर, उस ईमेल द्वारा प्राप्त सत्यापन कोड दर्ज करें जिसे अग्रेषित किया गया था।

अंत में, इसे डिफ़ॉल्ट प्रेषक पते (उसी पते के साथ उत्तर देने के विकल्प के साथ) के रूप में सेट किया जा सकता है।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/a95dO60.webp)

इस तरह, हमने SMTP मेल सर्वर की स्थापना पूरी कर ली है और साथ ही ईमेल भेजने और प्राप्त करने के लिए Google मेल का उपयोग करते हैं।

## कॉन्फ़िगरेशन सफल है या नहीं यह जांचने के लिए एक परीक्षण ईमेल भेजें

`ops/chasquid` दर्ज करें

`direnv allow` (direnv को पिछली एक-कुंजी आरंभीकरण प्रक्रिया में स्थापित किया गया है और शेल में एक हुक जोड़ा गया है)

तो भागो

```
user=i@wac.tax pass=xxxx to=iuser.link@gmail.com ./sendmail.coffee
```

मापदंडों का अर्थ इस प्रकार है

* उपयोगकर्ता: एसएमटीपी उपयोगकर्ता नाम
* पास: एसएमटीपी पासवर्ड
* को: प्राप्तकर्ता

आप एक परीक्षण ईमेल भेज सकते हैं।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/ae1iWyM.webp)

कॉन्फ़िगरेशन सफल है या नहीं, यह जांचने के लिए परीक्षण ईमेल प्राप्त करने के लिए जीमेल का उपयोग करने की सिफारिश की जाती है।

### टीएलएस मानक एन्क्रिप्शन

जैसा कि नीचे दिए गए चित्र में दिखाया गया है, यह छोटा लॉक है, जिसका अर्थ है कि एसएसएल प्रमाणपत्र सफलतापूर्वक सक्षम हो गया है।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/SrdbAwh.webp)

फिर "मूल ईमेल दिखाएं" पर क्लिक करें

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/qQQsdxg.webp)

### डीकेआईएम

जैसा कि नीचे चित्र में दिखाया गया है, जीमेल मूल मेल पेज डीकेआईएम प्रदर्शित करता है, जिसका अर्थ है कि डीकेआईएम कॉन्फ़िगरेशन सफल है।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/an6aXK6.webp)

मूल ईमेल के हेडर में प्राप्त की जाँच करें, और आप देख सकते हैं कि प्रेषक का पता IPV6 है, जिसका अर्थ है कि IPV6 भी सफलतापूर्वक कॉन्फ़िगर किया गया है।
